<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Navigation CMS</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 2rem; }
        .nav-test { display: flex; gap: 1rem; margin: 2rem 0; }
        .nav-btn { padding: 1rem; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
        .nav-btn.active { background: #28a745; }
        .tab-content { display: none; padding: 2rem; border: 1px solid #ddd; margin: 1rem 0; }
        .tab-content.active { display: block; background: #f8f9fa; }
        .log { background: #f1f1f1; padding: 1rem; margin: 1rem 0; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        .test-result { padding: 1rem; margin: 1rem 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ” Test de Navigation CMS</h1>
    
    <div class="test-result" id="test-status">
        <strong>ğŸ§ª Tests en cours...</strong>
    </div>

    <h2>Navigation Test</h2>
    <div class="nav-test">
        <button class="nav-btn active" onclick="showTab('tab1')">Onglet 1</button>
        <button class="nav-btn" onclick="showTab('tab2')">Onglet 2</button>
        <button class="nav-btn" onclick="showTab('tab3')">Onglet 3</button>
    </div>

    <div id="tab1-tab" class="tab-content active">
        <h3>ğŸ“‹ Onglet 1 - Test de base</h3>
        <p>Si vous voyez ce contenu, l'onglet 1 fonctionne.</p>
        <button onclick="testCMSNavigation()">ğŸ” Tester la navigation du CMS rÃ©el</button>
    </div>

    <div id="tab2-tab" class="tab-content">
        <h3>ğŸ”§ Onglet 2 - Diagnostic</h3>
        <p>Si vous voyez ce contenu, la navigation fonctionne !</p>
        <button onclick="inspectCMS()">ğŸ” Inspecter le CMS rÃ©el</button>
    </div>

    <div id="tab3-tab" class="tab-content">
        <h3>âš¡ Onglet 3 - Solutions</h3>
        <p>Onglet 3 actif - Navigation OK !</p>
        <button onclick="fixCMSNavigation()">ğŸ”§ Corriger le CMS</button>
    </div>

    <div class="log" id="log-output">Logs de test...\n</div>

    <script>
        let logOutput = document.getElementById('log-output');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logOutput.textContent += `[${timestamp}] ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
            console.log(message);
        }

        function showTab(tabName) {
            log(`ğŸ”„ Changement vers onglet: ${tabName}`);
            
            // DÃ©sactiver tous les onglets
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
                log(`  âŒ DÃ©sactivÃ©: ${tab.id}`);
            });
            
            // DÃ©sactiver tous les boutons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activer l'onglet cible
            const targetTab = document.getElementById(tabName + '-tab');
            if (targetTab) {
                targetTab.classList.add('active');
                log(`  âœ… ActivÃ©: ${targetTab.id}`);
            } else {
                log(`  âŒ ERREUR: Onglet non trouvÃ©: ${tabName}-tab`);
            }
            
            // Activer le bon bouton
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes(tabName)) {
                    btn.classList.add('active');
                    log(`  âœ… Bouton activÃ© pour: ${tabName}`);
                }
            });
        }

        function testCMSNavigation() {
            log('ğŸ§ª Test de navigation CMS rÃ©el...');
            
            // Ouvrir le CMS dans une nouvelle fenÃªtre
            const cmsWindow = window.open('cms.html', '_blank');
            
            setTimeout(() => {
                try {
                    // Tester si on peut accÃ©der au CMS
                    if (cmsWindow && !cmsWindow.closed) {
                        log('âœ… CMS ouvert avec succÃ¨s');
                        
                        // Tester la fonction showTab
                        if (typeof cmsWindow.showTab === 'function') {
                            log('âœ… Fonction showTab trouvÃ©e dans le CMS');
                            
                            // Tester les onglets
                            const tabs = ['dashboard', 'browse', 'create', 'manage', 'export'];
                            tabs.forEach(tab => {
                                const tabElement = cmsWindow.document.getElementById(tab + '-tab');
                                log(`${tab}: ${tabElement ? 'âœ… Existe' : 'âŒ Manquant'}`);
                            });
                            
                        } else {
                            log('âŒ Fonction showTab non trouvÃ©e dans le CMS');
                        }
                    } else {
                        log('âŒ Impossible d\'ouvrir le CMS');
                    }
                } catch (error) {
                    log(`âŒ Erreur lors du test: ${error.message}`);
                }
            }, 2000);
        }

        function inspectCMS() {
            log('ğŸ” Inspection du CMS...');
            
            fetch('cms.html')
                .then(response => response.text())
                .then(html => {
                    // VÃ©rifier la prÃ©sence des Ã©lÃ©ments clÃ©s
                    const hasShowTabFunction = html.includes('function showTab');
                    const hasTabContents = html.includes('tab-content');
                    const hasNavLinks = html.includes('onclick="showTab');
                    
                    log(`Fonction showTab: ${hasShowTabFunction ? 'âœ…' : 'âŒ'}`);
                    log(`Classes tab-content: ${hasTabContents ? 'âœ…' : 'âŒ'}`);
                    log(`Liens onclick: ${hasNavLinks ? 'âœ…' : 'âŒ'}`);
                    
                    // Compter les onglets
                    const tabMatches = html.match(/id="[^"]*-tab"/g);
                    log(`Onglets trouvÃ©s: ${tabMatches ? tabMatches.length : 0}`);
                    if (tabMatches) {
                        tabMatches.forEach(match => log(`  - ${match}`));
                    }
                    
                    // Compter les liens de navigation
                    const navMatches = html.match(/onclick="showTab\('[^']*'\)"/g);
                    log(`Liens navigation trouvÃ©s: ${navMatches ? navMatches.length : 0}`);
                    if (navMatches) {
                        navMatches.forEach(match => log(`  - ${match}`));
                    }
                })
                .catch(error => {
                    log(`âŒ Erreur lors de l'inspection: ${error.message}`);
                });
        }

        function fixCMSNavigation() {
            log('ğŸ”§ GÃ©nÃ©ration d\'une correction pour le CMS...');
            
            const fixedJS = `
// CORRECTION NAVIGATION CMS
function showTab(tabName) {
    console.log('Navigation vers:', tabName);
    
    // Masquer tous les onglets
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // DÃ©sactiver tous les liens
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
    });
    
    // Afficher l'onglet cible
    const targetTab = document.getElementById(tabName + '-tab');
    if (targetTab) {
        targetTab.classList.add('active');
        console.log('Onglet activÃ©:', tabName);
    } else {
        console.error('Onglet non trouvÃ©:', tabName + '-tab');
        return;
    }
    
    // Activer le lien correspondant
    document.querySelectorAll('.nav-link').forEach(link => {
        const onclick = link.getAttribute('onclick');
        if (onclick && onclick.includes("'" + tabName + "'")) {
            link.classList.add('active');
        }
    });
}

// Test automatique au chargement
document.addEventListener('DOMContentLoaded', function() {
    console.log('CMS chargÃ©, test de navigation...');
    const tabs = ['dashboard', 'browse', 'create', 'manage', 'export'];
    tabs.forEach(tab => {
        const element = document.getElementById(tab + '-tab');
        console.log(tab + ':', element ? 'OK' : 'MANQUANT');
    });
});
            `;
            
            log('âœ… Code de correction gÃ©nÃ©rÃ©');
            log('ğŸ“‹ Copiez ce code dans la console du CMS :');
            log(fixedJS);
            
            // CrÃ©er un fichier de correction
            const blob = new Blob([fixedJS], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cms-navigation-fix.js';
            a.click();
            URL.revokeObjectURL(url);
            
            log('ğŸ’¾ Fichier de correction tÃ©lÃ©chargÃ©: cms-navigation-fix.js');
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ Test de navigation initialisÃ©');
            log('âœ… Navigation de test fonctionnelle');
            
            document.getElementById('test-status').innerHTML = '<strong class="success">âœ… Page de test chargÃ©e avec succÃ¨s</strong>';
        });
    </script>
</body>
</html>
